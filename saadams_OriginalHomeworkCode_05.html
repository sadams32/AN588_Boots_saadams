<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Homework 5: Boots for Days!</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="saadams_OriginalHomeworkCode_05_files/libs/clipboard/clipboard.min.js"></script>
<script src="saadams_OriginalHomeworkCode_05_files/libs/quarto-html/quarto.js"></script>
<script src="saadams_OriginalHomeworkCode_05_files/libs/quarto-html/popper.min.js"></script>
<script src="saadams_OriginalHomeworkCode_05_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="saadams_OriginalHomeworkCode_05_files/libs/quarto-html/anchor.min.js"></script>
<link href="saadams_OriginalHomeworkCode_05_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="saadams_OriginalHomeworkCode_05_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="saadams_OriginalHomeworkCode_05_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="saadams_OriginalHomeworkCode_05_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="saadams_OriginalHomeworkCode_05_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#context" id="toc-context" class="nav-link active" data-scroll-target="#context">Context</a></li>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">Load Packages</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a></li>
  <li><a href="#task-1" id="toc-task-1" class="nav-link" data-scroll-target="#task-1">Task 1</a></li>
  <li><a href="#task-2" id="toc-task-2" class="nav-link" data-scroll-target="#task-2">Task 2</a>
  <ul>
  <li><a href="#bootstrapping" id="toc-bootstrapping" class="nav-link" data-scroll-target="#bootstrapping">Bootstrapping</a></li>
  <li><a href="#standard-error-estimates-and-cis-of-bootstrap" id="toc-standard-error-estimates-and-cis-of-bootstrap" class="nav-link" data-scroll-target="#standard-error-estimates-and-cis-of-bootstrap">Standard Error Estimates and CIs of Bootstrap</a></li>
  <li><a href="#how-does-the-former-compare-to-the-se-estimated-from-your-entire-dataset-using-the-formula-for-standard-error-implemented-in-lm" id="toc-how-does-the-former-compare-to-the-se-estimated-from-your-entire-dataset-using-the-formula-for-standard-error-implemented-in-lm" class="nav-link" data-scroll-target="#how-does-the-former-compare-to-the-se-estimated-from-your-entire-dataset-using-the-formula-for-standard-error-implemented-in-lm">How does the former compare to the SE estimated from your entire dataset using the formula for standard error implemented in lm()?</a></li>
  <li><a href="#how-does-the-latter-compare-to-the-95-ci-estimated-from-your-entire-dataset" id="toc-how-does-the-latter-compare-to-the-95-ci-estimated-from-your-entire-dataset" class="nav-link" data-scroll-target="#how-does-the-latter-compare-to-the-95-ci-estimated-from-your-entire-dataset">How does the latter compare to the 95% CI estimated from your entire dataset?</a></li>
  </ul></li>
  <li><a href="#extra-credit" id="toc-extra-credit" class="nav-link" data-scroll-target="#extra-credit">Extra Credit</a>
  <ul>
  <li><a href="#function-test-w-lm_model-from-above" id="toc-function-test-w-lm_model-from-above" class="nav-link" data-scroll-target="#function-test-w-lm_model-from-above">Function Test w/ lm_model (from above)</a></li>
  </ul></li>
  <li><a href="#extra-extra-credit" id="toc-extra-extra-credit" class="nav-link" data-scroll-target="#extra-extra-credit">EXTRA Extra Credit</a></li>
  <li><a href="#plot-data" id="toc-plot-data" class="nav-link" data-scroll-target="#plot-data">Plot Data</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 5: Boots for Days!</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><img src="img/boot.png" class="img-fluid"></p>
<section id="context" class="level2">
<h2 class="anchored" data-anchor-id="context">Context</h2>
<p>When we initially discussed the central limit theorem and confidence intervals, we showed how we could use bootstrapping to estimate standard errors and confidence intervals around certain parameter values, like the mean. Using bootstrapping, we could also do the same for estimating standard errors and CIs around regression parameters, such as 𝛽coefficients.</p>
</section>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(curl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Using libcurl 8.11.1 with OpenSSL/3.3.2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.2     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter()     masks stats::filter()
✖ dplyr::lag()        masks stats::lag()
✖ readr::parse_date() masks curl::parse_date()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">curl</span>(<span class="st">"https://raw.githubusercontent.com/fuzzyatelin/fuzzyatelin.github.io/refs/heads/master/AN588_Spring25/KamilarAndCooperData.csv"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(f, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Scientific_Name          Family          Genus      Species
1 Allenopithecus_nigroviridis Cercopithecidae Allenopithecus nigroviridis
2         Allocebus_trichotis Cercopithecidae      Allocebus    trichotis
3           Alouatta_belzebul        Atelidae       Alouatta     belzebul
4             Alouatta_caraya        Atelidae       Alouatta       caraya
5            Alouatta_guariba        Atelidae       Alouatta      guariba
6           Alouatta_palliata        Atelidae       Alouatta     palliata
  Brain_Size_Species_Mean Brain_Size_Female_Mean   Brain_size_Ref
1                   58.02                  53.70 Isler et al 2008
2                      NA                     NA                 
3                   52.84                  51.19 Isler et al 2008
4                   52.63                  47.80 Isler et al 2008
5                   51.70                  49.08 Isler et al 2008
6                   49.88                  48.04 Isler et al 2008
  Body_mass_male_mean Body_mass_female_mean Mass_Dimorphism
1                6130                  3180           1.928
2                  92                    84           1.095
3                7270                  5520           1.317
4                6525                  4240           1.539
5                5800                  4550           1.275
6                7150                  5350           1.336
                Mass_Ref MeanGroupSize AdultMales AdultFemale AdultSexRatio
1       Isler et al 2008            NA         NA          NA            NA
2 Smith and Jungers 1997          1.00       1.00         1.0            NA
3       Isler et al 2008          7.00       1.00         1.0          1.00
4       Isler et al 2008          8.00       2.30         3.3          1.43
5       Isler et al 2008          6.53       1.37         2.2          1.61
6       Isler et al 2008         12.00       2.90         6.3          2.17
                                                    Social_Organization_Ref
1                                                                          
2                                                             Kappeler 1997
3                                                       Campbell et al 2007
4 van Schaik et al. 1999; Kappeler and Pereira 2003; Nunn &amp; van Schaik 2000
5                                                       Campbell et al 2007
6 van Schaik et al. 1999; Kappeler and Pereira 2003; Nunn &amp; van Schaik 2000
  InterbirthInterval_d Gestation WeaningAge_d MaxLongevity_m LitterSz
1                   NA        NA       106.15          276.0     1.01
2                   NA        NA           NA             NA     1.00
3                   NA        NA           NA             NA       NA
4               337.62       187       323.16          243.6     1.01
5                   NA        NA           NA             NA       NA
6               684.37       186       495.60          300.0     1.02
   Life_History_Ref GR_MidRangeLat_dd Precip_Mean_mm Temp_Mean_degC AET_Mean_mm
1 Jones et al. 2009             -0.17         1574.0           25.2      1517.8
2                              -16.59         1902.3           20.3      1388.2
3                               -6.80         1643.5           24.9      1286.6
4 Jones et al. 2009            -20.34         1166.4           22.9      1193.1
5                              -21.13         1332.3           19.6      1225.7
6 Jones et al. 2009              6.95         1852.6           23.7      1300.0
  PET_Mean_mm       Climate_Ref HomeRange_km2      HomeRangeRef DayLength_km
1      1589.4 Jones et al. 2009            NA                             NA
2      1653.7 Jones et al. 2009            NA                             NA
3      1549.8 Jones et al. 2009            NA                             NA
4      1404.9 Jones et al. 2009            NA                           0.40
5      1332.2 Jones et al. 2009          0.03 Jones et al. 2009           NA
6      1633.9 Jones et al. 2009          0.19 Jones et al. 2009         0.32
      DayLengthRef Territoriality Fruit Leaves Fauna             DietRef1
1                              NA    NA                                  
2                              NA    NA                                  
3                              NA  57.3   19.1   0.0 Campbell et al. 2007
4 Nunn et al. 2003             NA  23.8   67.7   0.0 Campbell et al. 2007
5                              NA   5.2   73.0   0.0 Campbell et al. 2007
6 Nunn et al. 2003         0.6506  33.1   56.4   0.0 Campbell et al. 2007
  Canine_Dimorphism Canine_Dimorphism_Ref  Feed  Move  Rest Social
1             2.210   Plavcan &amp; Ruff 2008    NA    NA    NA     NA
2                NA                          NA    NA    NA     NA
3             1.811   Plavcan &amp; Ruff 2008 13.75 18.75 57.30  10.00
4             1.542   Plavcan &amp; Ruff 2008 15.90 17.60 61.60   4.90
5             1.783   Plavcan &amp; Ruff 2008 18.33 14.33 64.37   3.00
6             1.703   Plavcan &amp; Ruff 2008 17.94 12.32 66.14   3.64
   Activity_Budget_Ref
1                     
2                     
3 Campbell et al. 2007
4 Campbell et al. 2007
5 Campbell et al. 2007
6 Campbell et al. 2007</code></pre>
</div>
</div>
</section>
<section id="task-1" class="level2">
<h2 class="anchored" data-anchor-id="task-1">Task 1</h2>
<p>Using the “KamilarAndCooperData.csv” dataset, run a linear regression looking at log(HomeRange_km2) in relation to log(Body_mass_female_mean) and report your 𝛽 coeffiecients (slope and intercept).</p>
<p>Prepare and model data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter out NA for relevant columns (HomeRange_km2 and Body_mass_female_mean)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(HomeRange_km2) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Body_mass_female_mean))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mutate dataset d to have log of relevant variables</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_HomeRange_km2 =</span> <span class="fu">log</span>(HomeRange_km2), <span class="at">log_Body_mass_female_mean =</span> <span class="fu">log</span>(Body_mass_female_mean))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># make linear model with log(HomeRange_km2) in relation to log(Body_mass_female_mean)</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, log_HomeRange_km2 <span class="sc">~</span> log_Body_mass_female_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preview linear model results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_HomeRange_km2 ~ log_Body_mass_female_mean, data = d)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.3929 -0.9433 -0.0126  1.0944  3.6826 

Coefficients:
                          Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)               -9.44123    0.67293  -14.03   &lt;2e-16 ***
log_Body_mass_female_mean  1.03643    0.08488   12.21   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.423 on 135 degrees of freedom
Multiple R-squared:  0.5248,    Adjusted R-squared:  0.5213 
F-statistic: 149.1 on 1 and 135 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># write code to neatly print out beta coefficients slope and intercept</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># also print out n = for bootstrap sampling</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Intercept (β0):"</span>, <span class="fu">coef</span>(lm_model)[<span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># "\n" = go to next line; intercept of linear model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept (β0): -9.441231 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Slope (β1):"</span>, <span class="fu">coef</span>(lm_model)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># slope of linear model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Slope (β1): 1.036432 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"n ="</span>, <span class="fu">nrow</span>(d), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># print the number of rows that could actually be used in this model (because we had to filter out NA entries)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n = 137 </code></pre>
</div>
</div>
<p>//challenge// I tried initially to use print() to display the results above but it didn’t work. I looked it up on stack exchange and saw cat() is also used similarly. It seems to be working but I’m not sure what the difference is between them.</p>
</section>
<section id="task-2" class="level2">
<h2 class="anchored" data-anchor-id="task-2">Task 2</h2>
<section id="bootstrapping" class="level3">
<h3 class="anchored" data-anchor-id="bootstrapping">Bootstrapping</h3>
<p>Then, use bootstrapping to sample from your data 1000 times with replacement, each time fitting the same model and calculating the same coefficients. This generates a sampling distribution for each 𝛽 coefficient.</p>
<p>Set up parameters for bootstrapping:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co"># set seed </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>n_boot <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># number of bootstrap samples we will take</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="co"># sample size (# rows that have the HomeRange_km2 and Body_mass_female_mean)</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>boot_coef_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Intercept =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_boot), <span class="at">Slope =</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_boot)) <span class="co"># create dataframe that will store the coefficients (slope and intercept)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Bootstrap loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_boot) {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  boot_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># random sample from 1 to n rows; sampling with replacement; boot_index will be used to reference for sampling</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  boot_data <span class="ot">&lt;-</span> d[boot_index, ] <span class="co"># record the relevant index of the bootstrapped sample</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  boot_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(HomeRange_km2) <span class="sc">~</span> <span class="fu">log</span>(Body_mass_female_mean), <span class="at">data =</span> boot_data) <span class="co"># make model for bootstrapped data</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  boot_coef_df<span class="sc">$</span>Intercept[i] <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot_model)[<span class="dv">1</span>] <span class="co"># store intercept</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  boot_coef_df<span class="sc">$</span>Slope[i] <span class="ot">&lt;-</span> <span class="fu">coef</span>(boot_model)[<span class="dv">2</span>] <span class="co"># store slope</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preview bootstrap:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(boot_coef_df) <span class="co"># preview dataframe of bootstrapped samples</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Intercept     Slope
1 -10.660492 1.1720996
2  -8.805001 0.9681243
3  -9.321555 1.0154499
4  -9.165092 1.0161758
5  -9.183200 0.9737739
6  -9.497619 1.0453465</code></pre>
</div>
</div>
</section>
<section id="standard-error-estimates-and-cis-of-bootstrap" class="level3">
<h3 class="anchored" data-anchor-id="standard-error-estimates-and-cis-of-bootstrap">Standard Error Estimates and CIs of Bootstrap</h3>
<p>Estimate the standard error for each of your 𝛽 coefficients as the standard deviation of the sampling distribution from your bootstrap and determine the 95% CI for each of your 𝛽 coefficients based on the appropriate quantiles from your sampling distribution.</p>
<p>Strandard error estimates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate standard errors of $beta$ coefficients w/ standard deviation of bootstrapped sampling distribution</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>boot_se_intercept <span class="ot">&lt;-</span> <span class="fu">sd</span>(boot_coef_df<span class="sc">$</span>Intercept) <span class="co"># intercept estimate</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>boot_se_slope <span class="ot">&lt;-</span> <span class="fu">sd</span>(boot_coef_df<span class="sc">$</span>Slope) <span class="co"># slope estimate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>95% CIs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use quantile() in the range of 0.025 to 0.975 (the 95% confidence interval) to calculate CIs</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>boot_ci_intercept <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_coef_df<span class="sc">$</span>Intercept, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>boot_ci_slope <span class="ot">&lt;-</span> <span class="fu">quantile</span>(boot_coef_df<span class="sc">$</span>Slope, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>//challenge// I’m confused if we are supposed to do some kind of check for the “appropriate quantiles” (based on how the question was posed)</p>
<p>Print SEs and CIs for bootstrap distribution:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SEs</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Bootstrap Standard Error Estimate for Intercept:"</span>, boot_se_intercept, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># intercept SE estimate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap Standard Error Estimate for Intercept: 0.610387 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Bootstrap Standard Error Estimate for Slope"</span>, boot_se_slope, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># slope SE estimate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap Standard Error Estimate for Slope 0.07873769 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CIs</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Bootstrap 95% CI for Intercept:"</span>, boot_ci_intercept[<span class="dv">1</span>], <span class="st">"to"</span>, boot_ci_intercept[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># print 95% CI lower bound [1] to upper bound [2]; intercept CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap 95% CI for Intercept: -10.71941 to -8.266226 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Bootstrap 95% CI for Slope:"</span>, boot_ci_slope[<span class="dv">1</span>], <span class="st">"to"</span>, boot_ci_slope[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># slope CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bootstrap 95% CI for Slope: 0.8854299 to 1.191113 </code></pre>
</div>
</div>
</section>
<section id="how-does-the-former-compare-to-the-se-estimated-from-your-entire-dataset-using-the-formula-for-standard-error-implemented-in-lm" class="level3">
<h3 class="anchored" data-anchor-id="how-does-the-former-compare-to-the-se-estimated-from-your-entire-dataset-using-the-formula-for-standard-error-implemented-in-lm">How does the former compare to the SE estimated from your entire dataset using the formula for standard error implemented in lm()?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lm_model_se <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm_model)<span class="sc">$</span>coef[,<span class="dv">2</span>] <span class="co"># extract SE from original sample model</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print SEs for original sample</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Original Sample Standard Error Estimate for Intercept:"</span>, lm_model_se[<span class="dv">1</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># intercept SE estimate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original Sample Standard Error Estimate for Intercept: 0.6729346 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Original Sample Standard Error Estimate for Slope"</span>, lm_model_se[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># slope SE estimate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original Sample Standard Error Estimate for Slope 0.08487709 </code></pre>
</div>
</div>
<p>The original sample’s standard error was slightly higher, but very close, for both slope and intercept when compared to the bootstrap distribution SE estimate. That these values are so similar indicates that the assumptions made to perform a linear regression (like assuming normality or independence of observations) are valid and that the linear model is is accurately capturing the data we have given it.</p>
</section>
<section id="how-does-the-latter-compare-to-the-95-ci-estimated-from-your-entire-dataset" class="level3">
<h3 class="anchored" data-anchor-id="how-does-the-latter-compare-to-the-95-ci-estimated-from-your-entire-dataset">How does the latter compare to the 95% CI estimated from your entire dataset?</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lm_model_ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(lm_model, <span class="at">level =</span> <span class="fl">0.95</span>) <span class="co"># extract 95% CI from original sample model</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print 95% CIs for orginal sample</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Original Sample CI for Intercept:"</span>, lm_model_ci[<span class="dv">1</span>,<span class="dv">1</span>], <span class="st">"to"</span>, lm_model_ci[<span class="dv">1</span>,<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># intercept CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original Sample CI for Intercept: -10.77209 to -8.110374 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Original Sample CI for Slope:"</span>, lm_model_ci[<span class="dv">2</span>,<span class="dv">1</span>], <span class="st">"to"</span>, lm_model_ci[<span class="dv">2</span>,<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># slope CI</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original Sample CI for Slope: 0.8685707 to 1.204292 </code></pre>
</div>
</div>
<p>The 95% CIs are also very similar between the original sample and the boostrap distribution (neither is noticeably different in the range, or how narrow or wide that range is). Similar to the comparison with the SEs, this indicates that the linear model for the data is a good one and that the assumptions to make the linear model were valid.</p>
<p>//challenge// Is there anything different to say about what similarity in the CIs versus SEs indicates?</p>
</section>
</section>
<section id="extra-credit" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit">Extra Credit</h2>
<p>Write a FUNCTION that takes as its arguments a dataframe, “d”, a linear model, “m” (as a character string, e.g., “logHR~logBM”), a user-defined confidence interval level, “conf.level” (with default = 0.95), and a number of bootstrap replicates, “n” (with default = 1000). Your function should return a dataframe that includes: beta coefficient names; beta coefficients, standard errors, and upper and lower CI limits for the linear model based on your entire dataset; and mean beta coefficient estimates, SEs, and CI limits for those coefficients based on your bootstrap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>extrafun <span class="ot">&lt;-</span> <span class="cf">function</span>(d, m, <span class="at">conf.level =</span> <span class="fl">0.95</span>, <span class="at">n =</span> <span class="dv">1000</span>) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Original sample</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># fit and summarize linear model</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  extra_lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, <span class="fu">as.formula</span>(m)) <span class="co"># fit linear model; I used as.formula for lm functions </span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  extra_lm_model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(extra_lm_model) <span class="co"># summarize model</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># beta coefficients and SEs</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  extra_lm_model_coef <span class="ot">&lt;-</span> <span class="fu">coef</span>(extra_lm_model) <span class="co"># extract coefficients</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  extra_lm_model_se <span class="ot">&lt;-</span> extra_lm_model_summary<span class="sc">$</span>coef[,<span class="dv">2</span>] <span class="co"># extras SEs</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  extra_lm_model_ci <span class="ot">&lt;-</span> <span class="fu">confint</span>(extra_lm_model, <span class="at">level =</span> conf.level) <span class="co"># extract CI</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co"># bootstrap distribution</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># setup</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  n_row <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="co"># sample size</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  extra_boot_coef_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Intercept =</span> <span class="fu">numeric</span>(n), <span class="at">Slope =</span> <span class="fu">numeric</span>(n)) <span class="co"># create dataframe that will store the coefficients (slope and intercept)</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># loop</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  extra_boot_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n_row, <span class="at">size =</span> n_row, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="co"># random sample from 1 to n rows; sampling with replacement; boot_index will be used to reference for sampling</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  extra_boot_data <span class="ot">&lt;-</span> d[extra_boot_index, ] <span class="co"># record the relevant index of the bootstrapped sample</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  extra_boot_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> extra_boot_data, <span class="fu">as.formula</span>(m)) <span class="co"># make model for bootstrapped data</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  extra_boot_coef_df<span class="sc">$</span>Intercept[i] <span class="ot">&lt;-</span> <span class="fu">coef</span>(extra_boot_model)[<span class="dv">1</span>] <span class="co"># store intercept</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  extra_boot_coef_df<span class="sc">$</span>Slope[i] <span class="ot">&lt;-</span> <span class="fu">coef</span>(extra_boot_model)[<span class="dv">2</span>] <span class="co"># store slope</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># beta coefficients and SEs</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>  extra_boot_estimate_intercept <span class="ot">&lt;-</span> <span class="fu">mean</span>(extra_boot_coef_df<span class="sc">$</span>Intercept) <span class="co"># intercept estimate</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>  extra_boot_estimate_slope <span class="ot">&lt;-</span> <span class="fu">mean</span>(extra_boot_coef_df<span class="sc">$</span>Slope) <span class="co"># slope estimate</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>  extra_boot_se_intercept <span class="ot">&lt;-</span> <span class="fu">sd</span>(extra_boot_coef_df<span class="sc">$</span>Intercept) <span class="co"># intercept SE estimate</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>  extra_boot_se_slope <span class="ot">&lt;-</span> <span class="fu">sd</span>(extra_boot_coef_df<span class="sc">$</span>Slope) <span class="co"># slope SE estimate</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CIs (use quantiles instead of confint)</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>  lower_quantile <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span>conf.level) <span class="sc">/</span> <span class="dv">2</span> <span class="co"># calculate lower bound quantile of CI range</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>  upper_quantile <span class="ot">&lt;-</span> ((<span class="dv">1</span><span class="sc">-</span>conf.level) <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span> conf.level <span class="co"># calculate upper bound quantile of CI range</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  extra_boot_ci_intercept <span class="ot">&lt;-</span> <span class="fu">quantile</span>(extra_boot_coef_df<span class="sc">$</span>Intercept, <span class="fu">c</span>(lower_quantile, upper_quantile)) <span class="co"># store intercept CI limits</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>  extra_boot_ci_slope <span class="ot">&lt;-</span> <span class="fu">quantile</span>(extra_boot_coef_df<span class="sc">$</span>Slope, <span class="fu">c</span>(lower_quantile, upper_quantile)) <span class="co"># store slope CI limits</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize all results in one dataframe</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>  extra_results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">Beta_Coef_Name =</span> <span class="fu">names</span>(extra_lm_model_coef),</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">Original_Coef_Estimate =</span> extra_lm_model_coef,</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">Original_SE =</span> extra_lm_model_se,</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">Original_CI_Lower =</span> extra_lm_model_ci[, <span class="dv">1</span>],</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">Original_CI_upper =</span> extra_lm_model_ci[, <span class="dv">2</span>],</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Bootstrap_coef_estimate =</span> <span class="fu">c</span>(extra_boot_estimate_intercept, extra_boot_estimate_slope),</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">Bootstrap_SE =</span> <span class="fu">c</span>(extra_boot_se_intercept, extra_boot_se_slope),</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">Bootstrap_CI_Lower =</span> <span class="fu">c</span>(extra_boot_ci_intercept[<span class="dv">1</span>], extra_boot_ci_slope[<span class="dv">1</span>]),</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">Bootstrap_CI_Upper =</span> <span class="fu">c</span>(extra_boot_ci_intercept[<span class="dv">2</span>], extra_boot_ci_slope[<span class="dv">2</span>])</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(extra_results_df)</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>//challenge// My function wouldn’t work with as.factor -&gt; stackoverflow said in a similar thread to use as.formula…I’m not confident this is correct though.</p>
<section id="function-test-w-lm_model-from-above" class="level3">
<h3 class="anchored" data-anchor-id="function-test-w-lm_model-from-above">Function Test w/ lm_model (from above)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> <span class="fu">extrafun</span>(d, lm_model)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(test_results) <span class="co"># view results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                     Beta_Coef_Name Original_Coef_Estimate
(Intercept)                             (Intercept)              -9.441231
log_Body_mass_female_mean log_Body_mass_female_mean               1.036432
                          Original_SE Original_CI_Lower Original_CI_upper
(Intercept)                0.67293459       -10.7720889         -8.110374
log_Body_mass_female_mean  0.08487709         0.8685707          1.204292
                          Bootstrap_coef_estimate Bootstrap_SE
(Intercept)                             -9.463673   0.59093949
log_Body_mass_female_mean                1.038958   0.07677977
                          Bootstrap_CI_Lower Bootstrap_CI_Upper
(Intercept)                      -10.6474969          -8.406012
log_Body_mass_female_mean          0.8988777           1.189885</code></pre>
</div>
</div>
<p>These results all look pretty similar to what I got from doing Task 1/2!</p>
</section>
</section>
<section id="extra-extra-credit" class="level2">
<h2 class="anchored" data-anchor-id="extra-extra-credit">EXTRA Extra Credit</h2>
<p>Graph each beta value from the linear model and its corresponding mean value, lower CI and upper CI from a bootstrap as a function of number of bootstraps from 10 to 200 by 10s. HINT: the beta value from the linear model will be the same for all bootstraps and the mean beta value may not differ that much!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>boot_n <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">10</span>, <span class="at">to =</span> <span class="dv">200</span>, <span class="at">by =</span> <span class="dv">10</span>) <span class="co"># set number of bootstraps + increase by 10</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># make empty lists to store our results + numeric() for each result</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>original_intercept <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>original_slope <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>boot_intercept <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>boot_slope <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>boot_ci_lower_intercept <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>boot_ci_upper_intercept <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>boot_ci_lower_slope <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>boot_ci_upper_slope <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(boot_n))</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Bootstrap loop</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(boot_n)) {</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> boot_n[i] <span class="co"># set number of bootstraps</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  temp_results <span class="ot">&lt;-</span> <span class="fu">extrafun</span>(d, lm_model, <span class="at">n=</span>n) <span class="co"># call extrafun function</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store original coefs</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>  original_intercept[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Original_Coef_Estimate[<span class="dv">1</span>]</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  original_slope[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Original_Coef_Estimate[<span class="dv">2</span>]</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># store CIs and coefs for bootstrap</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  boot_intercept[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Bootstrap_coef_estimate[<span class="dv">1</span>]</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>  boot_slope[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Bootstrap_coef_estimate[<span class="dv">2</span>]</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  boot_ci_lower_intercept[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Bootstrap_CI_Lower[<span class="dv">1</span>]</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  boot_ci_upper_intercept[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Bootstrap_CI_Upper[<span class="dv">1</span>]</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  boot_ci_lower_slope[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Bootstrap_CI_Lower[<span class="dv">2</span>]</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  boot_ci_upper_slope[i] <span class="ot">&lt;-</span> temp_results<span class="sc">$</span>Bootstrap_CI_Upper[<span class="dv">2</span>]</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a><span class="co"># intercept data</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>intercept_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> boot_n,</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coef =</span> <span class="st">"Intercept"</span>,</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">Original =</span> original_intercept,</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bootstrap =</span> boot_intercept,</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI_Lower =</span> boot_ci_lower_intercept,</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI_Upper =</span> boot_ci_upper_intercept</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a><span class="co"># slope data</span></span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>slope_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> boot_n,</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">Coef =</span> <span class="st">"Slope"</span>,</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">Original =</span> original_slope,</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">Bootstrap =</span> boot_slope,</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI_Lower =</span> boot_ci_lower_slope,</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI_Upper =</span> boot_ci_upper_slope</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(intercept_data, slope_data) <span class="co"># combine slope and intercept dataframes</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plot_data) <span class="co"># check plot data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   n      Coef  Original Bootstrap  CI_Lower  CI_Upper
1 10 Intercept -9.441231 -9.631908 -10.33049 -9.180069
2 20 Intercept -9.441231 -9.242492 -10.02121 -8.290250
3 30 Intercept -9.441231 -9.310932 -10.81732 -7.676825
4 40 Intercept -9.441231 -9.622806 -10.97622 -8.639343
5 50 Intercept -9.441231 -9.519451 -10.67835 -8.278474
6 60 Intercept -9.441231 -9.283724 -10.24811 -8.351580</code></pre>
</div>
</div>
</section>
<section id="plot-data" class="level1">
<h1>Plot Data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">color =</span> Coef)) <span class="sc">+</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Bootstrap), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Bootstrap), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> CI_Lower, <span class="at">ymax =</span> CI_Upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Bootstrap Estimates with CIs"</span>, <span class="at">x =</span> <span class="st">"# Bootstraps"</span>, <span class="at">y =</span> <span class="st">"Coef. Estimate"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="saadams_OriginalHomeworkCode_05_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>//challenge// I feel like my code looks crazy - I have variables all of the place and I feel like there has to be a better way to write this.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>